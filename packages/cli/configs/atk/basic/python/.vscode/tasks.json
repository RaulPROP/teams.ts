// This file is automatically generated by M365 Agents Toolkit.
// The teamsfx tasks defined in this file require M365 Agents Toolkit version >= 5.0.0.
// See https://aka.ms/teamsfx-tasks for details on how to customize each task.
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Start Teams App Locally",
      "dependsOn": [
        "Validate prerequisites",
        "Start local tunnel",
        "Provision",
        "Deploy",
        "setup-env"
      ],
      "dependsOrder": "sequence"
    },
    {
      "label": "Validate prerequisites",
      "type": "teamsfx",
      "command": "debug-check-prerequisites",
      "args": {
        "prerequisites": [
          "python",
          "m365Account",
          "portOccupancy"
        ],
        "portOccupancy": [
          3978
        ]
      }
    },
    {
      "label": "Start local tunnel",
      "type": "teamsfx",
      "command": "debug-start-local-tunnel",
      "args": {
        "type": "dev-tunnel",
        "ports": [
          {
            "portNumber": 3978,
            "protocol": "http",
            "access": "public",
            "writeToEnvironmentFile": {
              "endpoint": "BOT_ENDPOINT",
              "domain": "BOT_DOMAIN"
            }
          }
        ],
        "env": "local"
      },
      "isBackground": true,
      "problemMatcher": "$teamsfx-local-tunnel-watch"
    },
    {
      "label": "Provision",
      "type": "teamsfx",
      "command": "provision",
      "args": {
        "env": "local"
      }
    },
    {
      "label": "Deploy",
      "type": "teamsfx",
      "command": "deploy",
      "args": {
        "env": "local"
      }
    },
    {
      "label": "setup-env",
      "type": "shell",
      "command": "if (!(Test-Path -Path .venv -PathType Container)) { uv venv }; uv sync",
      "problemMatcher": [],
      "group": {
          "kind": "build",
          "isDefault": true
      }
    },
    {
      "label": "Start Teams App (Test Tool)",
      "dependsOn": [
        "Validate prerequisites (Test Tool)",
        "Deploy (Test Tool)",
        "setup-env"
      ],
      "dependsOrder": "sequence"
    },
    {
      "label": "Validate prerequisites (Test Tool)",
      "type": "teamsfx",
      "command": "debug-check-prerequisites",
      "args": {
        "prerequisites": [
          "python",
          "portOccupancy"
        ],
        "portOccupancy": [
          3978,
          56150
        ]
      }
    },
    {
      "label": "Deploy (Test Tool)",
      "type": "teamsfx",
      "command": "deploy",
      "args": {
        "env": "testtool"
      }
    }
  ]
}
